@using ModulesApp.Components.ServerTasks.Ports
@using ModulesApp.Models.ServerTasks
@using MudBlazor

<TaskNodeWidget Node="Node"
            Header="Value">

    <MudSelect T="long"
               Value="Node.LongVal1"
               ValueChanged="ChangeType"
               Variant="Variant.Outlined"
               Label="Type"
               Margin="Margin.Dense">
        <MudSelectItem Value="(long)NodeValueType.String">@NodeValueType.String</MudSelectItem>
        <MudSelectItem Value="(long)NodeValueType.Number">@NodeValueType.Number</MudSelectItem>
        <MudSelectItem Value="(long)NodeValueType.Boolean">@NodeValueType.Boolean</MudSelectItem>
    </MudSelect>

    @if (Node.LongVal1 == (long)NodeValueType.String)
    {
        <MudTextField T="string"
                      @bind-Value="Node.StringVal1"
                      Label="Value"
                      Variant="Variant.Outlined"
                      Margin="Margin.Dense" />
    }
    else if (Node.LongVal1 == (long)NodeValueType.Number)
    {
        <MudNumericField T="double"
                         @bind-Value="Node.DoubleVal1"
                         Label="Value"
                         Variant="Variant.Outlined"
                         Margin="Margin.Dense" />
    }
    else if (Node.LongVal1 == (long)NodeValueType.Boolean)
    {
        <MudCheckBox T="bool"
                     Label="@Node.BoolVal1.ToString()"
                     @bind-value="@Node.BoolVal1"
                     Margin="Margin.Dense" />
    }

</TaskNodeWidget>

@code
{
    [Parameter] public ValueNode Node { get; set; } = null!;

    private void ChangeType(long value)
    {
        Node.LongVal1 = value;
        var port = Node.Ports.FirstOrDefault() as TaskPort;
        port!.DataType = (NodeValueType)value;
    }
}